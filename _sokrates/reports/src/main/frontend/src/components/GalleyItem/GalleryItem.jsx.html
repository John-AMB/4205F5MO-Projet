<html>
<head>
    <title>frontend/src/components/GalleyItem/GalleryItem.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend/src/components/GalleyItem/GalleryItem.jsx (<b>173</b> lines of code) (<a href="GalleryItem.jsx">raw</a>):</h3>
<div id="editor">import { useEffect, useRef, useState } from &quot;react&quot;;
import &quot;./GalleryItem.css&quot;;
import UserOptionsPortal from &quot;../UserOptionsPortal/UserOptionsPortal&quot;;
import EditIdeaPortal from &quot;../EditIdeaPortal/EditIdeaPortal&quot;;
import { useNavigate } from &quot;react-router-dom&quot;;
const GalleryItem = ({ item, refreshIdeas }) =&gt; {
  const navigate = useNavigate();
  const [open, setOpen] = useState(false);
  const buttonRef = useRef();
  const ref = useRef();
  const [span, setSpan] = useState(0);
  const [coords, setCoords] = useState({ top: 0, left: 0 });
  const [editing, setEditing] = useState(false);
  const [closing, setClosing] = useState(false);
  const [newTitle, setNewTitle] = useState(item.titre);
  const [newDescription, setNewDescription] = useState(item.description);

  const optionsRef = useRef();
  const editRef = useRef();

  useEffect(() =&gt; {
    const height = ref.current.clientHeight;
    setSpan(Math.ceil(height / 10));
  }, []);

  // Handle outside click for user options
  useEffect(() =&gt; {
    const handleClickOutside = (e) =&gt; {
      if (
        optionsRef.current &amp;&amp;
        !optionsRef.current.contains(e.target) &amp;&amp;
        buttonRef.current &amp;&amp;
        !buttonRef.current.contains(e.target)
      ) {
        setOpen(false);
      }
    };
    if (open) document.addEventListener(&quot;mousedown&quot;, handleClickOutside);
    return () =&gt; document.removeEventListener(&quot;mousedown&quot;, handleClickOutside);
  }, [open]);

  // Handle outside click for edit form
  useEffect(() =&gt; {
    const handleClickOutside = (e) =&gt; {
      if (editRef.current &amp;&amp; !editRef.current.contains(e.target)) {
        closeEditPortal();
      }
    };
    if (editing) document.addEventListener(&quot;mousedown&quot;, handleClickOutside);
    return () =&gt; document.removeEventListener(&quot;mousedown&quot;, handleClickOutside);
  }, [editing]);

  // Open/close options
  const toggleOptions = () =&gt; {
    if (buttonRef.current) {
      const rect = buttonRef.current.getBoundingClientRect();
      setCoords({
        top: rect.top + rect.height + window.scrollY + 4,
        left: rect.left + window.scrollX,
      });
    }
    setOpen((prev) =&gt; !prev);
  };

  // Delete idea
  const deleteIdea = async (id) =&gt; {
    try {
      const res = await fetch(`${import.meta.env.VITE_API_URL}/ideas/${id}`, {
        method: &quot;DELETE&quot;,
      });
      alert(&quot;are you sure you want to delete this idea?&quot;);
      if (res.ok) refreshIdeas();
      else console.error(&quot;Delete failed&quot;);
    } catch (err) {
      console.error(err);
    }
  };

  // Update idea
  const handleUpdateSubmit = async (e) =&gt; {
    e.preventDefault();
    try {
      const res = await fetch(
        `${import.meta.env.VITE_API_URL}/ideas/${item.id}`,
        {
          method: &quot;PUT&quot;,
          headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
          body: JSON.stringify({
            titre: newTitle,
            description: newDescription,
            photo: item.photo,
          }),
        }
      );

      if (res.ok) {
        closeEditPortal();
        refreshIdeas();
      } else console.error(&quot;Update failed&quot;);
    } catch (err) {
      console.error(err);
    }
  };

  // Close portal with animation
  const closeEditPortal = () =&gt; {
    setClosing(true);
    setTimeout(() =&gt; {
      setEditing(false);
      setClosing(false);
    }, 300); // match CSS animation duration
  };

  return (
    &lt;div className=&quot;galleryItem&quot; style={{ gridRowEnd: `span ${span}` }}&gt;
      &lt;img
        ref={ref}
        src={item.photo}
        alt={item.titre}
        onClick={() =&gt; navigate(`/idea/${item.id}`)}
      /&gt;

      &lt;div className=&quot;overlayIcons&quot;&gt;
        &lt;button ref={buttonRef} onClick={toggleOptions}&gt;
          &lt;img src=&quot;/general/more.svg&quot; alt=&quot;options&quot; /&gt;
        &lt;/button&gt;
      &lt;/div&gt;

      {open &amp;&amp; (
        &lt;UserOptionsPortal&gt;
          &lt;div
            ref={optionsRef}
            className=&quot;userOptions&quot;
            style={{
              position: &quot;absolute&quot;,
              top: coords.top,
              left: coords.left,
            }}
          &gt;
            &lt;div className=&quot;optionFormat&quot; onClick={() =&gt; deleteIdea(item.id)}&gt;
              Delete Pin
            &lt;/div&gt;
            &lt;div className=&quot;optionFormat&quot; onClick={() =&gt; setEditing(true)}&gt;
              Modify Pin
            &lt;/div&gt;
          &lt;/div&gt;
        &lt;/UserOptionsPortal&gt;
      )}

      {editing &amp;&amp; (
        &lt;EditIdeaPortal&gt;
          &lt;div
            className={`pageDimmer ${closing ? &quot;fadeOut&quot; : &quot;fadeIn&quot;}`}
            onClick={closeEditPortal}
          &gt;&lt;/div&gt;
          &lt;div
            ref={editRef}
            className={`editFormOverlay ${closing ? &quot;slideOut&quot; : &quot;slideIn&quot;}`}
          &gt;
            &lt;h2&gt;Modify idea&lt;/h2&gt;
            &lt;form className=&quot;editForm&quot; onSubmit={handleUpdateSubmit}&gt;
              &lt;input
                type=&quot;text&quot;
                value={newTitle}
                onChange={(e) =&gt; setNewTitle(e.target.value)}
                placeholder=&quot;New title&quot;
              /&gt;
              &lt;textarea
                value={newDescription}
                onChange={(e) =&gt; setNewDescription(e.target.value)}
                placeholder=&quot;New description&quot;
              /&gt;
              &lt;div className=&quot;editActions&quot;&gt;
                &lt;button type=&quot;submit&quot;&gt;Save&lt;/button&gt;
                &lt;button type=&quot;button&quot; onClick={closeEditPortal}&gt;
                  Cancel
                &lt;/button&gt;
              &lt;/div&gt;
            &lt;/form&gt;
          &lt;/div&gt;
        &lt;/EditIdeaPortal&gt;
      )}
    &lt;/div&gt;
  );
};

export default GalleryItem;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
