<html>
<head>
    <title>frontend/src/components/ModificationProfile/SupprimeAccount/SupprimeAccount.jsx</title>
    <style type="text/css" media="screen">
        #editor {
            position: absolute;
            top: 40px;
            right: 0;
            bottom: 0;
            left: 0;
        }
    </style>
</head>
<body style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif">
<h3 style="margin-bottom: 0">frontend/src/components/ModificationProfile/SupprimeAccount/SupprimeAccount.jsx (<b>89</b> lines of code) (<a href="SupprimeAccount.jsx">raw</a>):</h3>
<div id="editor">import { useContext, useState } from &quot;react&quot;;
import { useNavigate } from &quot;react-router-dom&quot;;
import { AuthContext } from &quot;../../AuthContext/auth-context&quot;;
import &quot;./SupprimeAccount.css&quot;;

const DeleteAccount = () =&gt; {
  const { user, logout } = useContext(AuthContext);
  const [username, setUsername] = useState(&quot;&quot;);
  const [confirmUsername, setConfirmUsername] = useState(&quot;&quot;);
  const [message, setMessage] = useState(&quot;&quot;);
  const [error, setError] = useState(&quot;&quot;);
  const [loading, setLoading] = useState(false);

  const navigate = useNavigate();

  const backendUrl = import.meta.env.VITE_API_URL || &quot;http://localhost:3001&quot;;

  const handleDelete = async () =&gt; {
    setError(&quot;&quot;);
    setMessage(&quot;&quot;);

    //confirme que tous les champs sont remplis
    if (!username || !confirmUsername) {
      return setError(&quot;Veuillez remplir tous les champs.&quot;);
    }

    //disable le bouton pendant le processus de suppression
    setLoading(true);

    //envoie la requete de suppression au backend
    try {
      const res = await fetch(`${backendUrl}/users/delete-account`, {
        method: &quot;DELETE&quot;,
        headers: { &quot;Content-Type&quot;: &quot;application/json&quot; },
        body: JSON.stringify({
          userId: user.id,
          username,
          confirmUsername,
        }),
      });

      //attend la reponse du backend
      const data = await res.json();

      if (!res.ok) {
        throw new Error(
          data.message || &quot;Erreur lors de la suppression du compte&quot;
        );
      }

      //handle la reponse

      setMessage(&quot;Compte supprim&eacute; avec succ&egrave;s.&quot;);
      logout(); // logout l'utilisateur apres la suppression -&gt; authcontext = false
      setTimeout(() =&gt; navigate(&quot;/&quot;), 1500);
    } catch (err) {
      setError(&quot;Erreur du serveur : &quot; + err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    &lt;div className=&quot;deleteAccount&quot;&gt;
      &lt;h2&gt;Delete your account&lt;/h2&gt;
      &lt;p&gt;
        To confirm deletion, please enter your username twice. This action is{&quot; &quot;}
        &lt;strong&gt;irreversible&lt;/strong&gt;.
      &lt;/p&gt;

      &lt;div className=&quot;inputGroup&quot;&gt;
        &lt;label&gt;Username&lt;/label&gt;
        &lt;input
          type=&quot;text&quot;
          placeholder=&quot;Enter your username&quot;
          value={username}
          onChange={(e) =&gt; setUsername(e.target.value)}
        /&gt;
      &lt;/div&gt;

      &lt;div className=&quot;inputGroup&quot;&gt;
        &lt;label&gt;Confirm Username&lt;/label&gt;
        &lt;input
          type=&quot;text&quot;
          placeholder=&quot;Confirm your username&quot;
          value={confirmUsername}
          onChange={(e) =&gt; setConfirmUsername(e.target.value)}
        /&gt;
      &lt;/div&gt;

      {error &amp;&amp; &lt;p className=&quot;error&quot;&gt;{error}&lt;/p&gt;}
      {message &amp;&amp; &lt;p className=&quot;success&quot;&gt;{message}&lt;/p&gt;}

      {/* bouton de suppression disabled lorsque loading = true*/}
      &lt;button className=&quot;deleteBtn&quot; onClick={handleDelete} disabled={loading}&gt;
        {loading ? &quot;Suppression...&quot; : &quot;Delete my account&quot;}
      &lt;/button&gt;

      {/* retour a la page des options*/}
      &lt;button className=&quot;cancelBtn&quot; onClick={() =&gt; navigate(-1)}&gt;
        Cancel
      &lt;/button&gt;
    &lt;/div&gt;
  );
};

export default DeleteAccount;
</div>
<script src="https://www.zeljkoobrenovic.com/tools/common/lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script>
    var editor = ace.edit("editor");
    editor.session.setMode("ace/mode/html");
    editor.setTheme("ace/theme/xcode");
    editor.setReadOnly(true);
    editor.setOption("wrap", true);
    editor.setPrintMarginColumn(120);
</script>
</body>
